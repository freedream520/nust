{% extends 'base.html' %}

{% set page_title = 'Calendrier %s' % (months.1|date('E Y'), ) %}

{% block style %}
<style>
table.table {
	table-layout: fixed;
}

h2 {
	margin-top: 0;
}

.buttons {
	text-align: right;
}

.buttons .btn {
	margin-bottom: 10px;
}

@media (max-width: 768px) { 
	.buttons {
		text-align: left;
	}
}

span.type {
	display: inline-block;
	width: 10px;
	height: 10px;
}
</style>
{% endblock %}

{% block content %}

<div class="container">

	<div class="row">
		<h2 class="col-sm-6">
			{% if member %}{{ member.first_name|lower|title }} {{ member.last_name|lower|title }} : {% endif %}{{months.1|date('E Y')}}
		</h2>

		<div class="col-sm-6 buttons">
			{% if not member %}
			<a class="btn btn-default" href="{% url export-month months.1.year, months.1.month %}"><i class="icon-down-open"></i> Export CSV</a>
			{% endif %}
			<a class="btn btn-info" href="{{pageyear|url(*pageargs + [months.1.year ])}}"><i class="icon-list-alt"></i> Calendrier annuel</a>
		</div>
	
	</div>

	<table class="table table-bordered table-condensed calendar hidden-xs">
		<tr>
			<th>Lundi</th>
			<th>Mardi</th>
			<th>Mercredi</th>
			<th>Jeudi</th>
			<th>Vendredi</th>
			<th>Samedi</th>
			<th>Dimanche</th>
		</tr>
		{% for week in weeks %}
		<tr>
			{% for day in week %}
			{% with sessions[day] as session %}
			<td class="day modal-action" href="{{pageday|url(*pageargs + [day.year, day.month, day.day])}}">

				<p class="date">
					{% if day.day == 1 or (loop.first and day.month != months.1.month) %}
					{{day|date('d E')}}
					{% else %}
					{{day|date('d')}}
					{% endif %}
				</p>
				{% if session %}
				<p class="session {{ session.type }}">
					{{session.name|default('Session sans nom')}}
          {% with session.garmin_activities.count() as garmin_nb %}
					{% if garmin_nb > 0 %}
            <i class="icon-location"></i>{% if garmin_nb > 1 %}x{{ garmin_nb }}{% endif %}
          {% endif %}
          {% endwith %}
					{% if session.sport == 'cycling' %}
					<i class="icon-bicycle"></i>
					{% elif session.sport == 'swimming' %}
					<i class="icon-swimming"></i>
					{% endif %}
				</p>
				{% if session.plan_session %}
				<p>
					<i class="icon-tags"> </i> {{ session.plan_session.week.plan.name|truncate(10) }}
				</p>
				{% endif %}
				{% endif %}
			</td>
			{% endwith %}
			{% endfor %}
		</tr>
		{% endfor %}
	</table>

	<div class="visible-xs row-striped">
		{% for day in sessions %}
		{% with sessions[day] as session %}
		<div class="row modal-action" href="{{pageday|url(*pageargs + [day.year, day.month, day.day])}}">
			<div class="col-xs-12">
				<strong>{{day|date('l d E Y')|title()}}</strong>
				<div>
					<span class="type {{ session.type }}"></span>
					{{session.name|default('Session sans nom')}}
          {% with session.garmin_activities.count() as garmin_nb %}
					{% if garmin_nb > 0 %}
            <i class="icon-location"></i>{% if garmin_nb > 1 %}x{{ garmin_nb }}{% endif %}
          {% endif %}
          {% endwith %}
					{% if session.sport == 'cycling' %}
					<i class="icon-bicycle"></i>
					{% elif session.sport == 'swimming' %}
					<i class="icon-swimming"></i>
					{% endif %}
				</div>
				{% if session.plan_session %}
				<div>
					<i class="icon-tags"> </i> {{ session.plan_session.week.plan.name|truncate(10) }}
				</div>
				{% endif %}
			</div>
		</div>
		{% endwith %}
		{% endfor %}
	</div>


	<ul class="pager">
		{% if months.0 %}
		<li class="previous">
			<a href="{{pagemonth|url(*pageargs + [months.0.year, months.0.month ])}}">&laquo; {{months.0|date('E Y')}}</a>
		</li>
		{% endif %}
		{% if months.2 %}
		<li class="next">
			<a href="{{pagemonth|url(*pageargs + [months.2.year, months.2.month ])}}">{{months.2|date('E Y')}} &raquo;</a>
		</li>
		{% endif %}
	</ul>

</div>

{% endblock %}
